<h1>ライフログ＜日報一覧＞＞</h1>

<!-- 新規日報作成ボタン -->
<div class="d-flex justify-content-between mb-3">
  <%= link_to "新規日報作成", new_daily_report_path, class: "btn btn-primary px-4" %>
</div>


<!-- カレンダーと成長グラフを統合 -->
<div class="row">
  <div class="col-md-6">
    <h3>カレンダー & 成長の推移</h3>
    <div id="calendar"></div>
    <canvas id="growthChart"></canvas>
  </div>
  
  <div class="col-md-6">
    <h3>位置情報</h3>
    <div id="map" style="height: 500px;"></div>
  </div>
</div>

<!-- スキルタグのフィルタリング -->
<form action="<%= daily_reports_path %>" method="get" class="mb-4">
  <div class="row">
    <div class="col-md-4">
      <label>期間で検索:</label>
      <select name="date_range" class="form-select">
        <option value="7">過去7日間</option>
        <option value="30">過去30日間</option>
        <option value="90">過去3ヶ月</option>
      </select>
    </div>

    <div class="col-md-4">
      <label>スキルタグで検索:</label>
      <select name="skill_tag" class="form-select">
        <% SkillTag.all.each do |tag| %>
          <option value="<%= tag.id %>"><%= tag.name %></option>
        <% end %>
      </select>
    </div>

    <div class="col-md-4">
      <label>キーワード検索:</label>
      <%= text_field_tag :keyword, params[:keyword], class: "form-control", placeholder: "キーワード入力" %>
    </div>
  </div>

  <button type="submit" class="btn btn-primary mt-3">検索</button>
</form>

<!-- 時系列タイムライン表示 -->
<h3>日報履歴（タイムライン）</h3>
<div class="timeline">
  <% @daily_reports.order(date: :desc).each do |report| %>
    <div class="timeline-item">
      <div class="timeline-icon">
        <i class="fas fa-code"></i>
      </div>
      <div class="timeline-content">
        <h5><%= report.date.strftime("%Y年%m月%d日") %></h5>
        <p><strong>場所:</strong> <%= report.location %></p>
        <p><%= truncate(report.content, length: 100) %></p>

        <!-- スキルタグ表示 -->
        <p><strong>使用スキル:</strong>
          <% report.skill_tags.each do |tag| %>
            <span class="badge <%= tag.color_class %>"><%= tag.name %></span>
          <% end %>
        </p>

        <% if @user == current_user %>
          <div class="d-flex justify-content-between mt-2">
            <%= link_to '編集', edit_daily_report_path(report), class: "btn btn-warning btn-sm" %>
            <%= link_to '削除', daily_report_path(report), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger btn-sm" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<% @daily_reports.each do |report| %>
  <p>
    <strong>公開状態:</strong>
    <% if report.visibility == "public" %>
      🔓 公開
    <% else %>
      🔒 非公開
    <% end %>
  </p>
<% end %>

<h3>カレンダー & 成長の推移</h3>
<div id="calendar"></div>
<canvas id="growthChart"></canvas>


<div class="text-center mt-4">
  <%= link_to "マイページに戻る", users_mypage_path, class: "btn btn-outline-secondary btn-lg px-4" %>
</div>