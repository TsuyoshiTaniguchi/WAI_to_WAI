<li class="nav-item">
  <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" data-turbo="false">
    📩 未読通知 <span class="badge badge-danger"><%= @unread_notifications_count %></span>
  </button>
  <div class="dropdown-menu" data-turbo="false">
    <% if current_user.notifications.where(read: false).any? %>
      <% current_user.notifications.where(read: false).limit(5).each do |notification| %>
        <% message = case notification.source_type
          when "Comment"
            # sourceが存在していれば、関連するuserのnameを表示。なければ、適切なフォールバック文字列を使用。
            if notification.source && notification.source.user
              "#{notification.source.user.name} さんがあなたの投稿にコメントしました！"
            else
              "コメントが投稿されました（詳細不明）"
            end
          when "Like"
            if notification.source && notification.source.user
              "#{notification.source.user.name} さんがあなたの投稿をいいねしました！"
            else
              "投稿にいいねがありました（詳細不明）"
            end
          else
            "新しい通知があります！"
        end %>
        <%= link_to message, notification_path(notification), method: :patch, data: { turbo: false }, class: "dropdown-item" %>
      <% end %>
    <% else %>
      <span class="dropdown-item disabled">未読の通知はありません</span>
    <% end %>
  </div>
</li>

<li class="nav-item">
  <!-- 通知一覧ページへのボタン -->
  <%= link_to "通知一覧を見る", notifications_path, class: "btn btn-info", data: { turbo: false } %> <!-- Turbo を防ぐ -->
</li>