<h1 class="mt-5 mb-4">ÊäïÁ®ø‰∏ÄË¶ß</h1>

<!-- ‚îÄ‚îÄ ÊäïÁ®ø„Éï„Ç£„É´„Çø„Éº ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="btn-group mb-3">
  <%= link_to "„Åô„Åπ„Å¶„ÅÆÊäïÁ®ø",
              posts_path,
              class: "btn btn-outline-secondary #{params[:filter].nil? ? 'active' : ''}" %>

  <% unless guest_blocked? %> <!-- ‚òÖ „Ç≤„Çπ„Éà„ÅØ ‚Äú„Éï„Ç©„É≠„Éº‰∏≠‚Äù „Éï„Ç£„É´„Çø‰∏çÂèØ -->
    <%= link_to "„Éï„Ç©„É≠„Éº„Åó„Å¶„ÅÑ„Çã‰∫∫„ÅÆÊäïÁ®ø",
                posts_path(filter: 'following'),
                class: "btn btn-outline-primary #{params[:filter] == 'following' ? 'active' : ''}" %>
  <% end %>
</div>

<!-- ‚îÄ‚îÄ Ê§úÁ¥¢„Éê„Éº ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="mb-3">
  <%= form_with url: posts_path, method: :get, local: true, class: "form-inline w-100" do |f| %>
    <div class="input-group flex-fill mr-2">
      <%= f.text_field :query, value: params[:query], class: "form-control", placeholder: "„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢" %>
    </div>
    <div class="input-group flex-fill mr-2">
      <%= f.text_field :tag, value: params[:tag], class: "form-control", placeholder: "„Çø„Ç∞Ê§úÁ¥¢" %>
    </div>
    <div class="input-group mr-2">
      <%= select_tag :category, options_for_select(["„Åô„Åπ„Å¶", "ÊäÄË°ì", "Ë∂£Âë≥", "Êó•Â∏∏", "„Åù„ÅÆ‰ªñ"], params[:category]), class: "form-control" %>
    </div>
    <%= f.submit "Ê§úÁ¥¢", class: "btn btn-primary" %>
  <% end %>
</div>

<!-- ‚îÄ‚îÄ ÊäïÁ®ø„Çø„Ç§„É†„É©„Ç§„É≥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<% if @posts.any? %>
  <div class="timeline">
    <% @posts.each do |post| %>
      <div class="timeline-item mb-4 p-3 border rounded">
        <div class="timeline-content">
          <!-- „É¶„Éº„Ç∂„Éº„Ç¢„Ç§„Ç≥„É≥„Å®ÂêçÂâç -->
          <div class="d-flex align-items-center mb-2">
            <% if post.user.profile_image.attached? %>
              <%= image_tag post.user.profile_image.variant(resize_to_fill: [50, 50]),
                            class: "rounded-circle mr-2" %>
            <% end %>
            <div>
              <h5 class="mb-0">
                <%= link_to post.user.name, user_path(post.user), class: "text-decoration-none" %>
              </h5>
              <small class="text-muted"><%= time_ago_in_words(post.created_at) %></small>
            </div>
          </div>

          <!-- „Çø„Ç§„Éà„É´ -->
          <h2>
            <%= link_to post.title, post_path(post), class: "text-decoration-none font-weight-bold" %>
          </h2>

          <!-- „Ç´„ÉÜ„Ç¥„É™ -->
          <% if post.category.present? %>
            <div class="mb-2">
              <strong>„Ç´„ÉÜ„Ç¥„É™:</strong>
              <span class="badge badge-primary ml-1"><%= post.category %></span>
            </div>
          <% end %>

          <!-- „Çø„Ç∞ -->
          <% if post.tag_list.present? %>
            <div class="mb-2">
              <strong>„Çø„Ç∞:</strong>
              <% post.tag_list.each do |tag| %>
                <%= link_to tag, posts_path(tag: tag), class: "badge badge-info mr-1 ml-1" %>
              <% end %>
            </div>
          <% end %>

          <!-- Êú¨Êñá„Çµ„Éû„É™ -->
          <p><%= sanitize(truncate(post.content, length: 200)) %></p>

          <!-- ÁîªÂÉè -->
          <% if post.images.attached? %>
            <div class="post-images mb-3">
              <% post.images.each do |image| %>
                <%= image_tag image.variant(resize: "400x400"), class: "img-thumbnail mb-2" %>
              <% end %>
            </div>
          <% end %>

          <!-- „Ç≥„Éº„Éâ -->
          <% if post.code_snippet.present? %>
            <pre class="code-block"><%= sanitize(post.code_snippet) %></pre>
          <% end %>

          <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ -->
          <% unless guest_blocked? %>  <!-- ‚òÖ „Ç≤„Çπ„Éà„ÅØ„ÅÑ„ÅÑ„Å≠‰∏çÂèØ -->
            <div id="post-likes-<%= post.id %>">
              <%= render 'public/likes/like_button', post: post %>
            </div>
          <% end %>

          <!-- „Ç≥„É°„É≥„Éà„É™„É≥„ÇØÔºàÈñ≤Ë¶ß„ÅØË®±ÂèØÔºâ -->
          <div class="d-flex mt-3">
            <% comment_count = post.comments.count %>
            <%= link_to "üí¨ „Ç≥„É°„É≥„Éà (#{comment_count})", post_path(post),
                        class: "btn btn-outline-secondary btn-sm mr-2" %>
          </div>

          <!-- Á∑®ÈõÜÔºèÂâäÈô§ÔºàÊú¨‰∫∫ & Èùû„Ç≤„Çπ„ÉàÔºâ -->
          <% if post.user == current_user && !guest_blocked? %>
            <div class="d-flex mt-2">
              <%= link_to "Á∑®ÈõÜ", edit_post_path(post), class: "btn btn-warning btn-sm mr-2" %>
              <%= link_to "ÂâäÈô§", post_path(post),
                          method: :delete,
                          data: { confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" },
                          class: "btn btn-danger btn-sm" %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
  <%= paginate @posts %>
<% else %>
  <div class="alert alert-info">
    <p>„Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
    <% unless guest_blocked? %>  <!-- ‚òÖ „Ç≤„Çπ„Éà„Å´„ÅØÊñ∞Ë¶èÊäïÁ®øË™òÂ∞é„ÇíÈö†„Åô -->
      <p>ÊúÄÂàù„ÅÆÊäïÁ®ø„Çí„Åó„Å¶„Åø„Åæ„Åõ„Çì„ÅãÔºü</p>
      <%= link_to "Êñ∞Ë¶èÊäïÁ®ø„Åô„Çã", new_post_path, class: "btn btn-primary" %>
    <% end %>
  </div>
<% end %>

<!-- ‚îÄ‚îÄ „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="d-flex justify-content-center flex-wrap mb-3">
  <%= link_to "„Éû„Ç§„Éö„Éº„Ç∏", users_mypage_path, class: "btn btn-outline-secondary btn-lg mr-2 mb-2" %>

  <% unless guest_blocked? %>  <!-- ‚òÖ „Ç≤„Çπ„Éà„ÅØÊñ∞Ë¶èÊäïÁ®ø„Éú„Çø„É≥ÈùûË°®Á§∫ -->
    <%= link_to "Êñ∞Ë¶èÊäïÁ®ø", new_post_path, class: "btn btn-primary btn-lg mr-2 mb-2" %>
  <% end %>

  <%= link_to "ÊäïÁ®ø‰∏ÄË¶ß„Å∏Êàª„Çã", posts_path, class: "btn btn-secondary btn-lg mb-2" %>
</div>