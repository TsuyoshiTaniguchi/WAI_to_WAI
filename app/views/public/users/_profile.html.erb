<div class="container">
  <!-- プロフィール情報 -->
  <div class="card p-3 mb-3">
    <div class="row">
      <!-- 左側：プロフィール情報 -->
      <div class="col-md-6 text-center">
        <%= image_tag user.profile_image.attached? ? user.profile_image.variant(resize_to_fill: [200, 200]) : "no_image.jpg", 
                      class: "profile-image mb-3", width: 200, height: 200 %>
        <h3 class="mb-3"><%= user.name %> さんのプロフィール</h3>
        <p>メールアドレス: <%= user.email %></p>
        <p>登録日: <%= user.created_at.strftime("%Y年%m月%d日") %></p>
      </div>
      
      <!-- 右側：フォロー状態＆所属グループ -->
      <div class="col-md-6">
        <!-- フォロー状態（シンプルなバッジ系） -->
        <div class="text-center mb-3">
          <span class="badge bg-primary fs-5 me-2">
            フォロー中: <%= user.following.count %>
          </span>
          <span class="badge bg-secondary fs-5">
            フォロワー: <%= user.followers.count %>
          </span>
          <div class="mt-2">
            <%= link_to "フォロー一覧", following_user_path(user), class: "btn btn-outline-primary btn-sm me-2" %>
            <%= link_to "フォロワー一覧", followers_user_path(user), class: "btn btn-outline-secondary btn-sm" %>
          </div>
        </div>
    
        <!-- 所属グループ（シンプルなインラインリスト） -->
        <div class="text-center">
          <h5 class="mb-2">所属グループ</h5>
          <% if user.joined_groups.any? %>
            <ul class="list-inline">
              <% user.joined_groups.each do |group| %>
                <li class="list-inline-item mb-2">
                  <%= link_to group.name, group_path(group), class: "badge bg-primary text-decoration-none" %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">まだグループに参加していません。</p>
          <% end %>
        </div>
      </div> 
    </div>
  </div>

  <!-- 自己紹介 -->
  <div class="card p-3 mb-3">
    <h3 class="mb-3">自己PRと成長ストーリー</h3>
    <% if user.personal_statement.present? %>
      <p><%= user.personal_statement %></p>
    <% else %>
      <p class="text-muted">自己PRが未記入です。</p>
    <% end %>
  </div>

  <!-- 通報ボタン（自己以外の場合） -->
  <% unless current_user.guest? || current_user == user %>
    <div class="card p-3 mb-3">
      <h3 class="mb-3">ユーザーの通報</h3>
      <% if user.reported? %>
        <p class="text-danger fw-bold">⚠️ このユーザーは通報済みです。</p>
      <% else %>
        <%= link_to "⚠️ このユーザーを通報", report_user_path(user), method: :patch, class: "btn btn-danger btn-sm" %>
      <% end %>
    </div>
  <% end %>


  <!-- アクションボタン（自己のページの場合） -->
  <% if show_actions && (current_user == user) %>
    <div class="mt-4 text-center">
      <div class="btn-group flex-wrap" role="group">
        <%= link_to edit_user_path(user), class: "btn btn-primary btn-lg d-flex align-items-center gap-2" do %>
          <i class="fas fa-user-edit"></i>
          <span>プロフィール編集</span>
        <% end %>
        <%= link_to withdraw_user_path(user), method: :patch, data: {confirm: "本当に退会しますか？"}, class: "btn btn-danger btn-lg d-flex align-items-center gap-2" do %>
          <i class="fas fa-user-slash"></i>
          <span>退会する</span>
        <% end %>
      </div>
    </div>
  <% end %>
</div>