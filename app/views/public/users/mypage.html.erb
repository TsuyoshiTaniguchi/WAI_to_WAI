<h1>マイページ</h1>

<!-- タブ切り替え -->
<ul class="nav nav-pills mb-3">
  <li class="nav-item">
    <%= link_to "プロフィール", "#profile", class: "nav-link active", data: { bs_toggle: "tab" } %>
  </li>
  <li class="nav-item">
    <%= link_to "投稿一覧", "#posts", class: "nav-link", data: { bs_toggle: "tab" } %>
  </li>
  <li class="nav-item">
    <%= link_to "日報管理", "#daily_reports", class: "nav-link", data: { bs_toggle: "tab" } %>
  </li>
</ul>

<!-- タブパネルを tab-content でラップ -->
<div class="tab-content">
  <!-- プロフィール情報 -->
  <div class="tab-pane fade show active" id="profile">
    <%= render partial: "public/users/profile", locals: { user: current_user, show_actions: true } %>
  </div>

  <!-- 投稿一覧 -->
  <div class="tab-pane fade" id="posts">
    <%= render partial: "public/posts/post_list", locals: { user: current_user, show_create_button: true, show_edit_button: true } %>
  </div>

  <!-- 日報管理 -->
  <div class="tab-pane fade" id="daily_reports">
    <h3>ライフログ</h3>
    <!-- マイページ内のカレンダー表示部分 -->
    <div id="calendar-wrapper" style="min-height: 450px; width: 100%;">
      <div id="calendar" style="min-height: 400px; width: 100%;"></div>
    </div>
  
    <!-- カレンダーを日報の近くに配置 -->
    <div class="d-flex justify-content-between mb-3">
      <%= link_to "新規日報作成", new_daily_report_path, class: "btn btn-primary px-4" %>
      <%= link_to "日報一覧へ移動", daily_reports_path, class: "btn btn-outline-secondary px-4" %>
    </div>
    
    <table class="table mt-3">
      <thead>
        <tr>
          <th>日付</th>
          <th>内容</th>
          <th>公開設定</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <% @daily_reports.each do |report| %>
          <tr>
            <td><%= report.date %></td>
            <td><%= report.content.truncate(50) %></td>
            <td>
              <!-- 現在の状態をバッジで表示 -->
              <div class="mb-2">
                現在の状態：
                <% if report.visibility == "public_report" %>
                  <span class="badge bg-success">公開</span>
                <% else %>
                  <span class="badge bg-secondary">非公開</span>
                <% end %>
              </div>
            </td>
            <td>
              <%= link_to "編集", edit_daily_report_path(report), class: "btn btn-sm btn-warning" %>
              <%= link_to "削除", daily_report_path(report), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-sm btn-danger" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    
    <!-- ここで最新のパフォーマンス推移やスキル成長のグラフを含める -->
    <%= render 'public/daily_reports/performance_chart' %>
  </div>

<!-- ユーザー一覧ボタン -->
<div class="text-center mt-4">
  <%= link_to "ユーザー一覧", users_path, class: "btn btn-lg btn-outline-secondary px-4" %>
</div>